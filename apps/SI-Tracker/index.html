<!doctype html>
<html lang="en" class="theme-dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SI Live Tracker +</title>
  <meta name="theme-color" content="#0b0f14"/>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <link rel="apple-touch-icon" href="./icons/icon-180.png" />
  <link rel="manifest" href="./manifest.json">
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="appbar">
    <div class="left">
      <h1>SI Live Tracker <span class="plus">+</span></h1>
      <span id="offline" class="offline hidden">Offline</span>
    </div>
    <nav class="tabs">
      <button data-tab="list" class="active">List</button>
      <button data-tab="calendar">Calendar</button>
      <button data-tab="reports">Reports</button>
      <button data-tab="settings">Settings</button>
      <a class="muted" href="https://developer.parliament.uk/" target="_blank" rel="noopener">APIs ↗</a>
    </nav>
  </header>

  <main>
    <!-- List -->
    <section id="list" class="tab active">
      <div class="toolbar">
        <div class="group">
          <input id="q" type="search" placeholder="Search title, SI number…" />
          <select id="procedure">
            <option value="">Any procedure</option>
            <option>Affirmative</option>
            <option>Negative</option>
            <option>Made affirmative</option>
            <option>No procedure</option>
          </select>
          <select id="state">
            <option value="">Any state</option>
            <option value="due">Within 40 days</option>
            <option value="overdue">40 days elapsed</option>
            <option value="approved">Approved</option>
            <option value="withdrawn">Withdrawn</option>
            <option value="reported">Committee reported</option>
          </select>
          <select id="committee">
            <option value="">Any committee</option>
            <option value="jcsi">JCSI</option>
            <option value="slsc">SLSC</option>
          </select>
          <label class="inline">From<input id="from" type="date"/></label>
          <label class="inline">To<input id="to" type="date"/></label>
          <details>
            <summary>Departments</summary>
            <div id="deptChips" class="chips"></div>
          </details>
        </div>
        <div class="group">
          <button id="refresh">↻ Refresh</button>
          <button id="saveView">Save view</button>
          <button id="exportCSV">Export CSV</button>
          <span class="muted small" id="lastSync"></span>
          <button id="toggleTheme" title="Toggle theme">☼</button>
        </div>
      </div>

      <div id="views" class="chips"></div>

      <div id="cards" class="cards"></div>

      <dialog id="detail">
        <article class="panel">
          <header class="panel-head">
            <h3 id="d-title"></h3>
            <button id="d-close">✕</button>
          </header>
          <div class="panel-body">
            <p id="d-meta" class="muted"></p>
            <div id="d-badges" class="chips"></div>
            <h4>Timeline</h4>
            <ul id="d-timeline" class="timeline"></ul>
            <div id="d-links" class="chips"></div>
          </div>
        </article>
      </dialog>
    </section>

    <!-- Calendar -->
    <section id="calendar" class="tab">
      <div class="toolbar">
        <button id="prevMonth">←</button>
        <div class="monthLabel"></div>
        <button id="nextMonth">→</button>
        <div class="group">
          <button id="downloadICS">Download ICS</button>
          <button id="printView">Print</button>
        </div>
      </div>
      <div id="cal" class="calendar"></div>
    </section>

    <!-- Reports (committee summaries) -->
    <section id="reports" class="tab">
      <div class="toolbar">
        <input id="repSearch" placeholder="Search in summaries…" />
        <div class="group">
          <label class="inline">Proxy <input id="proxyUrl" placeholder="https://si-proxy.yourname.workers.dev/?url=" /></label>
          <button id="saveProxy">Save</button>
          <button id="fetchSummaries">Fetch latest summaries</button>
        </div>
      </div>
      <div id="reportList" class="cards"></div>
      <p class="muted small">Note: many Parliament pages block cross-origin requests. If summaries fail to load, set a CORS proxy above (Cloudflare Worker code included in the ZIP).</p>
    </section>

    <!-- Settings -->
    <section id="settings" class="tab">
      <div class="cards">
        <article class="card">
          <h3>Data source & sync</h3>
          <p class="muted">Fetches from the UK Parliament Linked Data API (JSON). Adjust lookback and pages if you want more/less data.</p>
          <div class="row">
            <label class="inline">Lookback days <input id="lookback" type="number" min="7" max="365" value="120"/></label>
            <label class="inline">Max pages <input id="maxPages" type="number" min="1" max="50" value="10"/></label>
            <label class="inline">Auto-refresh (mins) <input id="autoMins" type="number" min="0" max="1440" value="0"/></label>
            <button id="saveSettings">Save</button>
          </div>
        </article>
      </div>
    </section>
  </main>

  <template id="cardTemplate"><article class="card"></article></template>

  <script src="./app.js" defer></script>
  <script>if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js')</script>
</body>
</html>
