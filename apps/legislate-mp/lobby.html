<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Legislate?! — Lobby</title>
  <link rel="stylesheet" href="./css/style.css?v=LG-1">
  <style>
    .lobby { max-width: 720px; margin: 4rem auto; padding: 2rem; background: #fff; border-radius: 12px; box-shadow: 0 4px 18px rgba(0,0,0,.06); }
    .lobby h1 { margin-top: 0; }
    .row { display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; }
    .grow { flex: 1 1 260px; }
    .button { padding: .8rem 1.2rem; border: 0; border-radius: 8px; background: #1d70b8; color: #fff; cursor: pointer; font-size: 1rem; }
    .button--secondary { background: #6f72af; }
    .input, select { padding: .8rem 1rem; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; width: 100%; }
    .error { color: #d4351c; min-height: 1.2em; }
  </style>
</head>
<body>

  <!-- Header (copied from mp.html for consistency) -->
  <header class="header">
    <div class="header__inner">
      <div class="header__brand">
        <img src="./assets/logo.png" alt="Legislate Logo" class="header__logo">
        <span class="header__title">Legislate?!</span>
      </div>
      <nav class="header__nav">
        <a href="./lobby.html" class="header__link">Lobby</a>
        <a href="./mp.html" class="header__link">Game</a>
      </nav>
    </div>
  </header>

  <!-- Lobby card -->
  <main>
    <div class="lobby">
      <h1>Lobby</h1>

      <!-- Shared name field -->
      <div class="row">
        <input id="playerName" class="input grow" placeholder="Your name" maxlength="24"
               aria-label="Your name" autocomplete="name" autocapitalize="words" inputmode="text">
      </div>

      <!-- Host creates room -->
      <div class="row">
        <select id="hostCount" class="input" aria-label="Number of players">
          <option value="2">2 players</option>
          <option value="3">3 players</option>
          <option value="4" selected>4 players</option>
          <option value="5">5 players</option>
          <option value="6">6 players</option>
        </select>
        <button id="createBtn" class="button">Create Room</button>
      </div>

      <!-- Guests join -->
      <div class="row">
        <input id="roomInput" class="input" style="width:10rem" placeholder="Room code" maxlength="8"
               aria-label="Room code" autocapitalize="characters" inputmode="text">
        <button id="joinBtn" class="button button--secondary">Join Room</button>
      </div>

      <div id="err" class="error"></div>
    </div>
  </main>

  <script>
    function code4(){
      const A='ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
      let s=''; for(let i=0;i<4;i++) s+=A[Math.floor(Math.random()*A.length)];
      return s;
    }
    function go(room, host, name, count){
      const safeName = (name || '').trim().slice(0,24) || (host ? 'Host' : 'Player');
      sessionStorage.setItem('MP_ROOM', room.toUpperCase());
      sessionStorage.setItem('MP_HOST', host ? '1' : '0');
      sessionStorage.setItem('MP_NAME', safeName);
      if (host && count) sessionStorage.setItem('MP_PLAYER_COUNT', String(count));
      window.location.href = './mp.html';
    }

    document.getElementById('createBtn').addEventListener('click', ()=>{
      const name  = document.getElementById('playerName').value;
      const count = Number(document.getElementById('hostCount').value) || 4;
      const room  = code4();
      go(room, true, name, count);
    });

    document.getElementById('joinBtn').addEventListener('click', ()=>{
      const name = document.getElementById('playerName').value;
      const room = (document.getElementById('roomInput').value || '').trim().toUpperCase();
      const err  = document.getElementById('err');
      if (!/^[A-Z0-9]{3,8}$/.test(room)) { err.textContent='Enter a valid room code (3–8 chars).'; return; }
      err.textContent='';
      go(room, false, name);
    });
  </script>
</body>
</html>