import { Config } from '../../config/index.js'; export function createBoardRenderer({imgEl,tokensLayer,board}){function measure(){const r=imgEl.getBoundingClientRect();return{w:r.width,h:r.height}} function tokenRadius(n){const w=measure().w;const density=[1,1,1,0.95,0.9,0.85,0.8][n]||0.8;const r=Math.round(w*Config.tokenBaseFactor*density);return Math.max(Config.tokenMin,Math.min(Config.tokenMax,r))} function placeTokens(players){const {w,h}=measure();const r=tokenRadius(players.length);tokensLayer.innerHTML='';const by=new Map();for(const p of players){const k=p.position; if(!by.has(k)) by.set(k,[]); by.get(k).push(p)} for(const [idx,group] of by.entries()){const s=board.spaces.find(sp=>sp.index===idx); if(!s) continue; const cx=(s.x/100)*w, cy=(s.y/100)*h; const c=group.length; for(let i=0;i<c;i++){const p=group[i]; const ang=(Math.PI*2*i)/Math.max(1,c); const rad=r*Config.overlapRadiusFactor*(c>1?1:0); const x=cx+Math.cos(ang)*rad, y=cy+Math.sin(ang)*rad; const d=document.createElement('div'); d.className='token'; d.style.cssText=`position:absolute;transform:translate(-50%,-50%);left:${x}px;top:${y}px;width:${r*2}px;height:${r*2}px;border-radius:50%;border:2px solid #0b0c0c;background:${p.color}`; d.title=`${p.name} @ ${idx}`; tokensLayer.appendChild(d);} } } window.addEventListener('resize',()=>{ tokensLayer.innerHTML='' }); return { placeTokens, tokenRadius } }