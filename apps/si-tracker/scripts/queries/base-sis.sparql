# Broader capture of SIs since the last election (2024-07-04): any 'laid' OR 'made' step date
PREFIX :   <https://id.parliament.uk/schema/>
PREFIX id: <https://id.parliament.uk/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

SELECT DISTINCT ?workPackage ?title ?keyDate ?laidDate ?procedureKind ?procedureScrutiny ?legislationURI ?departmentLabel
WHERE {
  ?workPackage a :WorkPackage ;
               :workPackagedThing ?thing .
  ?thing a :StatutoryInstrument .

  OPTIONAL { ?thing :preferredLabel ?title . }

  # Gather any BusinessItem dates that indicate either a laid or made action
  OPTIONAL {
    ?bi a :BusinessItem ;
         :workPackagedThing ?thing ;
         :businessItemHasProcedureStep ?step ;
         :businessItemDate ?date .
    ?step :preferredLabel ?stepLabel .
    FILTER ( CONTAINS(LCASE(?stepLabel), "laid") || CONTAINS(LCASE(?stepLabel), "made") )
    BIND(?date AS ?laidDate)
    BIND(?date AS ?keyDate)
  }

  OPTIONAL {
    ?workPackage :hasProcedure ?proc .
    OPTIONAL { ?proc :procedureKind ?procedureKind . }
    OPTIONAL { ?proc :procedureRouteScrutiny ?procedureScrutiny . }
  }

  OPTIONAL {
    ?thing :layingBody ?dept .
    ?dept  :preferredLabel ?departmentLabel .
  }

  OPTIONAL { ?thing :workPackageableThingHasLegislationURL ?legislationURI . }

  FILTER (BOUND(?keyDate) && ?keyDate >= "2024-07-04"^^xsd:date)
}
ORDER BY DESC(?keyDate)
