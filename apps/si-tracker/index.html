<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SI Tracker</title>
  <link rel="icon" href="./assets/logo.svg">
  <link rel="stylesheet" href="./css/style.css" />
  <meta name="color-scheme" content="dark light" />
</head>
<body>
  <header class="header" role="banner">
    <div class="header-inner container">
      <div class="brand">
        <img src="./assets/logo.svg" alt="SI Tracker">
        <div class="name">SI Tracker</div>
      </div>
      <nav class="tabs" role="tablist" aria-label="Primary">
        <button class="tab active" role="tab" aria-selected="true" data-tab="list">Laid</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="calendar">Calendar</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="archive">Archive</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="about">About</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="watch">Watchlist</button>
      </nav>
    </div>
  </header>

  <main class="container" id="main" tabindex="-1">
    <section id="list" class="view" aria-labelledby="tab-list">
      <div class="toolbar">
        <div class="search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"/></svg>
          <input id="q" placeholder="Search title, department or within EMs (Enter)…" />
        </div>
        <div style="display:flex; gap:6px; flex-wrap:wrap">
          <button class="chip" data-filter="procedure:affirmative">Affirmative</button>
          <button class="chip" data-filter="procedure:negative">Negative</button>
          <button class="chip" data-filter="flag:committee">Committee flag</button>
          <button class="chip" data-filter="breach:yes">21‑day breach</button>
          <button class="chip" data-filter="year:current">This Session/Year</button>
          <button class="chip" data-filter="watch:yes" title="Filter to watchlist">Watchlist</button>
        </div>
        <div style="display:flex; gap:6px">
          <button class="btn" id="saveView">Save view</button>
          <button class="btn" id="copyLink">Copy link</button>
          <button class="btn" id="exportCsv">Export CSV</button>
        </div>
      </div>
      <div id="cards" class="grid" aria-live="polite"></div>
    </section>

    <section id="calendar" class="view" hidden>
      <div id="calendar-controls" class="toolbar">
        <div style="display:flex; gap:8px; align-items:center">
          <span style="color:var(--muted)">Affirmative instruments</span>
          <label class="chip"><input type="checkbox" id="calShowMotions" checked> Motions</label>
          <label class="chip"><input type="checkbox" id="calShowDLC"> DL Committee sittings</label>
        </div>
        <div style="display:flex; gap:8px">
          <button class="btn" id="prevMonth">Prev</button>
          <button class="btn" id="today">Today</button>
          <button class="btn" id="nextMonth">Next</button>
          <button class="btn" id="exportICS">Export month (.ics)</button>
        </div>
      </div>
      <div id="calendar-grid" class="calendar" aria-label="Affirmative calendar"></div>
    </section>

    <section id="archive" class="view" hidden>
      <p class="muted">
        The archive is repo‑backed. Edit <code>data/archive.json</code> in GitHub. Use “Archive…” to download a merged file.
      </p>
      <div id="archive-cards" class="grid"></div>
    </section>

    <section id="watch" class="view" hidden>
      <h2>Watchlist</h2>
      <div style="display:flex; gap:8px; margin-bottom:10px">
        <button class="btn" id="exportWatch">Export watchlist</button>
        <label class="btn">
          Import… <input type="file" id="importWatch" accept="application/json" style="display:none">
        </label>
      </div>
      <div id="watch-cards" class="grid"></div>
    </section>

    <section id="about" class="view" hidden>
      <h2>About this project</h2>
      <p>This site refreshes data nightly from Parliament’s SPARQL endpoint and legislation.gov.uk, prebuilds JSON, and serves a static UI on GitHub Pages.</p>
    </section>
  </main>

  <footer class="footer">
    <div id="buildInfo">Build: — • Items: —</div>
  </footer>

  <div id="drawer" class="drawer" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="shade"></div>
    <div class="panel" role="document">
      <button class="btn close" id="closeDrawer" aria-label="Close (Esc)">Close</button>
      <div id="drawerContent"></div>
    </div>
  </div>

  <script type="module" src="./js/app.js"></script>
  <script src="./js/index-loader.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(()=>{});
    }
  </script>
</body>
</html>
